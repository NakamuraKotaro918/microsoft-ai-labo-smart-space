# Bicep ã«ã‚ˆã‚‹ Azure ãƒ‡ãƒ—ãƒ­ã‚¤

## ğŸš€ **æ¦‚è¦**

Microsoft AI Labo Smart Space ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ Azure Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ **å‰ææ¡ä»¶**

### **å¿…è¦ãªãƒ„ãƒ¼ãƒ«**
- Azure CLI 2.0+
- Bicep CLI
- Git
- Bash ã‚·ã‚§ãƒ«

### **å¿…è¦ãªæ¨©é™**
- Azure ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®æ‰€æœ‰è€…ã¾ãŸã¯å…±åŒä½œæˆè€…
- Azure AD ã§ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ä½œæˆæ¨©é™

## ğŸ—ï¸ **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**

### **ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¿«é©å›        â”‚    â”‚   SONY ITRIOS   â”‚    â”‚   SmartPhone    â”‚
â”‚   (MQTT)        â”‚    â”‚   (HTTP/API)    â”‚    â”‚   (HTTP/API)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â–¼                      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Azure IoT Hub                               â”‚
â”‚                    (MQTT Broker)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Azure App Service                           â”‚
â”‚                    (Dashboard API)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Azure Cosmos DB                             â”‚
â”‚                    (NoSQL Database)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Azure CDN                                   â”‚
â”‚                    (Content Delivery)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Web Dashboard                               â”‚
â”‚                    (Static Web App)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ **ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ**

### **1. ç’°å¢ƒã®æº–å‚™**

```bash
# Azure CLI ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
az version

# Bicep ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
az bicep version

# Azure ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³
az login
```

### **2. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³**

```bash
git clone https://github.com/NakamuraKotaro918/microsoft-ai-labo-smart-space.git
cd microsoft-ai-labo-smart-space
```

### **3. é–‹ç™ºç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤**

```bash
cd infrastructure

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œè¨¼
./deploy.sh dev --validate

# What-if åˆ†æï¼ˆå¤‰æ›´å†…å®¹ã®ç¢ºèªï¼‰
./deploy.sh dev --what-if

# å®Ÿéš›ã®ãƒ‡ãƒ—ãƒ­ã‚¤
./deploy.sh dev
```

### **4. æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤**

```bash
# æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
./deploy.sh prod
```

## ğŸ“ **ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ**

```
infrastructure/
â”œâ”€â”€ main.bicep              # ãƒ¡ã‚¤ãƒ³ã®Bicepãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ parameters.dev.json     # é–‹ç™ºç’°å¢ƒç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
â”œâ”€â”€ parameters.prod.json    # æœ¬ç•ªç’°å¢ƒç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
â”œâ”€â”€ deploy.sh               # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ README.md               # è©³ç´°ãªèª¬æ˜
```

## âš™ï¸ **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨­å®š**

### **é–‹ç™ºç’°å¢ƒ (parameters.dev.json)**
```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "environment": {
      "value": "dev"
    },
    "appServicePlanSku": {
      "value": "B1"
    },
    "cosmosDbThroughput": {
      "value": 400
    }
  }
}
```

### **æœ¬ç•ªç’°å¢ƒ (parameters.prod.json)**
```json
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "environment": {
      "value": "prod"
    },
    "appServicePlanSku": {
      "value": "S1"
    },
    "cosmosDbThroughput": {
      "value": 1000
    }
  }
}
```

## ğŸ”§ **ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ç”¨æ–¹æ³•**

### **åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•**
```bash
./deploy.sh [environment] [options]
```

### **ã‚ªãƒ—ã‚·ãƒ§ãƒ³**
- `--validate`: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œè¨¼ã®ã¿å®Ÿè¡Œ
- `--what-if`: å¤‰æ›´å†…å®¹ã®ç¢ºèªï¼ˆWhat-if åˆ†æï¼‰
- `--help`: ãƒ˜ãƒ«ãƒ—ã®è¡¨ç¤º

### **ä¾‹**
```bash
# é–‹ç™ºç’°å¢ƒã®æ¤œè¨¼
./deploy.sh dev --validate

# æœ¬ç•ªç’°å¢ƒã®What-ifåˆ†æ
./deploy.sh prod --what-if

# é–‹ç™ºç’°å¢ƒã®ãƒ‡ãƒ—ãƒ­ã‚¤
./deploy.sh dev
```

## ğŸ“Š **ãƒ‡ãƒ—ãƒ­ã‚¤ã®ç›£è¦–**

### **Azure ãƒãƒ¼ã‚¿ãƒ«ã§ã®ç¢ºèª**
1. [Azure ãƒãƒ¼ã‚¿ãƒ«](https://portal.azure.com) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ— `rg-mass-smart-space-[environment]` ã‚’ç¢ºèª
3. å„ãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’ç¢ºèª

### **ãƒ­ã‚°ã®ç¢ºèª**
```bash
# ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ­ã‚°ã®ç¢ºèª
az deployment group show \
  --resource-group "rg-mass-smart-space-dev" \
  --name "deployment-[timestamp]"

# ãƒªã‚½ãƒ¼ã‚¹ã®ä¸€è¦§è¡¨ç¤º
az resource list \
  --resource-group "rg-mass-smart-space-dev" \
  --output table
```

## ğŸš¨ **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**

### **ã‚ˆãã‚ã‚‹å•é¡Œ**

#### **1. Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œè¨¼ã‚¨ãƒ©ãƒ¼**
```bash
# Bicep ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
az bicep version

# å¿…è¦ã«å¿œã˜ã¦æ›´æ–°
az bicep upgrade
```

#### **2. æ¨©é™ä¸è¶³ã‚¨ãƒ©ãƒ¼**
```bash
# ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ç¢ºèª
az role assignment list --assignee $(az account show --query user.name -o tsv)
```

#### **3. ãƒªã‚½ãƒ¼ã‚¹åã®é‡è¤‡ã‚¨ãƒ©ãƒ¼**
- ãƒªã‚½ãƒ¼ã‚¹åã«ä¸€æ„ã®è­˜åˆ¥å­ã‚’è¿½åŠ 
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚„ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ã‚’ä½¿ç”¨

### **ãƒ‡ãƒãƒƒã‚°æ–¹æ³•**
```bash
# è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›
./deploy.sh dev --verbose

# ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ç¢ºèª
az resource show \
  --name "app-mass-smart-space-dev" \
  --resource-group "rg-mass-smart-space-dev" \
  --resource-type "Microsoft.Web/sites"
```

## ğŸ” **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**

### **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†**
- æ©Ÿå¯†æƒ…å ±ã¯ Azure Key Vault ã«ä¿å­˜
- ç’°å¢ƒå¤‰æ•°ã«ç›´æ¥è¨˜è¿°ã—ãªã„
- ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®æ¨©é™ã‚’æœ€å°é™ã«è¨­å®š

### **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
- å¿…è¦æœ€å°é™ã®ãƒãƒ¼ãƒˆã®ã¿é–‹æ”¾
- ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ä½¿ç”¨ã‚’æ¤œè¨
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã®è¨­å®š

## ğŸ“ˆ **ã‚³ã‚¹ãƒˆæœ€é©åŒ–**

### **é–‹ç™ºç’°å¢ƒ**
- Basic ãƒ—ãƒ©ãƒ³ã‚’ä½¿ç”¨
- å¿…è¦æœ€å°é™ã®ãƒªã‚½ãƒ¼ã‚¹ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤
- è‡ªå‹•ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã®è¨­å®š

### **æœ¬ç•ªç’°å¢ƒ**
- é©åˆ‡ãª SKU ã‚’é¸æŠ
- è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®è¨­å®š
- ä½¿ç”¨ã—ã¦ã„ãªã„ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤

## ğŸ”— **é–¢é€£ãƒªãƒ³ã‚¯**

- [Bicep ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.microsoft.com/azure/azure-resource-manager/bicep/)
- [Azure CLI ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.microsoft.com/cli/azure/)
- [Azure Resource Manager ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.microsoft.com/azure/azure-resource-manager/)

## ğŸ“ **ã‚µãƒãƒ¼ãƒˆ**

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã‚„è³ªå•ãŒã‚ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã‚’ã”åˆ©ç”¨ãã ã•ã„ï¼š

- **GitHub Issues**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª²é¡Œç®¡ç†
- **Azure ã‚µãƒãƒ¼ãƒˆ**: æœ‰æ–™ã‚µãƒãƒ¼ãƒˆï¼ˆã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«å«ã¾ã‚Œã‚‹å ´åˆï¼‰
- **ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£**: Stack Overflow, Microsoft Q&A

---

**æœ€çµ‚æ›´æ–°**: 2024å¹´8æœˆ21æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
